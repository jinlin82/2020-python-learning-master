---
title: "Numpy 用法"
author: "Jin"
date: "2020年6月"
institute: 中南财经政法大学统计与数学学院
csl: ./style/chinese-gb7714-2015-numeric.csl
css: ./style/markdown.css
bibliography: [./Bibfile.bib]
eqnPrefixTemplate: ($$i$$)
link-citations: true
linkReferences: true
chapters: true
tableEqns: false
autoEqnLabels: false
classoption: "aspectratio=1610"
---

```{r setup, echo=F, purl=F}
knitr::opts_knit$set(root.dir = getwd())
knitr::opts_chunk$set(echo = TRUE, results = 'hide')
knitr::opts_chunk$set(warning = FALSE, message=FALSE)
knitr::opts_chunk$set(fig.align="center"
                      ## ,out.width="0.9\\textwidth" # latex
                      ,out.width="80%" # for both latex and html
                      ,fig.width=5, fig.height=3
                      )
```

```{r prepare, echo=F, purl=F}
rm(list=ls())
options(digits=4)
options(scipen=100)
graphics.off()
Sys.setlocale("LC_ALL", "Chinese")
library(reticulate)
```


# Introduction


### Facts

1.  Initial release: As Numeric, 1995; as NumPy, 2006
2.  Stable release: 1.11.2 / 3 October 2016;
3.  Website: <http://www.numpy.org>
4.  History: <https://en.wikipedia.org/wiki/NumPy>

### What is NumPy?

1.  NumPy is the fundamental package for scientific computing in Python.
2.  It is a Python library that provides a multidimensional array
    object, various derived objects (such as masked arrays and
    matrices), and an assortment of routines for fast operations on
    arrays, including


1.  mathematical,
2.  logical,
3.  shape manipulation,
4.  sorting, selecting, I/O,
5.  discrete Fourier transforms, basic linear algebra,
6.  basic statistical operations, random simulation and much more.

### NumPy

1.  At the core of the NumPy package, is the **ndarray** object.
2.  This encapsulates n-dimensional arrays of homogeneous data types,
    with many operations being performed in compiled code for
    performance.
3.  The points about sequence size and speed are particularly important
    in scientific computing.

### ndarray object

1.  Vectorization:Vectorization describes the absence of any explicit
    looping, indexing, etc., in the code - these things are taking
    place, of course, just "behind the scenes" in optimized,
    pre-compiled C code.
2.  Broadcasting:Broadcasting is the term used to describe the implicit
    element-by-element behavior of operations.
3.  NumPy fully supports an object-oriented approach with ndarray.
    ndarray is a class, possessing numerous methods and attributes.

# Basics

## Array Creation

### `array` function

1.  create an array from a regular Python list or tuple using the
    **`array`** function. The type of the resulting array is deduced
    from the type of the elements in the sequences.
2.  array transforms sequences of sequences into two-dimensional arrays,
    sequences of sequences of sequences into three-dimensional arrays,
    and so on.
3.  Often, the elements of an array are originally unknown, but its size
    is known.

### arrays with initial placeholder content

1.  The function **`zeros`** creates an array full of zeros,
2.  the function **`ones`** creates an array full of ones,
3.  the function **`empty`** creates an array whose initial content is
    random and depends on the state of the memory.
4.  the function `diag` creates the diagonal array,
5.  the function **`eye`** or **`identity`** creates an array with ones
    on the diagonal and zeros elsewhere.

### `arange` and `linspace` function

1.  **`arange`**:
2.  **`linspace`**:

### ndarray对象的属性

1.  ndarray.ndim
2.  ndarray.shape
3.  ndarray.size
4.  ndarray.dtype
5.  ndarray.itemsize
6.  ndarray.data

## 基本操作

### 基本操作

1.  数组上的算术运算符按元素方式应用。创建一个新的数组并填充结果。
2.  矩阵乘积可使用点函数或方法执行:
3.  许多一元运算，比如计算数组中所有元素的总和，都是作为ndarray类的方法实现的。
4.  通过指定轴参数，可以应用一个沿着数组的指定轴进行的操作(类似于R中的apply函数)。

### 例子

``` {python}
import numpy as np
a=np.arange(4)
b=np.array([2,5,8,9])
a*b

A=np.arange(12).reshape(3,4)
B=np.arange(13,25).reshape(4,3)
np.dot(A, B)
A.dot(B)
A.sum()
A.sum(axis=0)
A.sum(axis=1)

"""END"""
```

### 通用函数

1.  NumPy提供了熟悉的数学函数，如sin、cos和exp。
2.  在NumPy中，这些函数称为\“通用函数\”(ufunc)。
3.  在NumPy中，这些函数按元素对数组进行操作，生成一个数组作为输出。

``` {python}
A=np.arange(12).reshape(3,4)
np.exp(A)
np.sqrt(A)

"""END"""
```

## 索引、切片和迭代

### 索引、切片和迭代

1.  一维数组可以被索引、切片和迭代，就像列表和其他Python序列一样。

``` {python}
x=np.arange(12)**2
x[3]
x[2:6]
x[7:]
x[::-1]
x[9:2:-3]

"""END"""
```

### 索引、切片和迭代

1.  多维数组每个轴可以有一个索引。这些索引以元组的形式给出，中间用逗号分隔。
2.  当提供的索引少于轴的数量时，缺失的索引被认为是完整的片。

``` {python}
A=np.arange(24).reshape(4,6)
A[2,3]
A[1:3, 2:4]
A[1]
A[:, 2:4]
A[..., 3]

"""END"""
```

### 索引、切片和迭代

1.  点(…)表示生成完整索引元组所需的冒号。
2.  例如，如果x是一个有5个轴的数组，那么

-   `x[1, 2, ...]` is equivalent to `x[1, 2, :, :, :]`,
-   `x[..., 3]` to `x[:, : ,: ,:, 3]`
-   `x[4, ..., 5, :]` to `x[4, :, :, 5, :]`

### Indexing, Slicing and Iterating

1.  Iterating over multidimensional arrays is done with respect to
    the first axis
2.  if one wants to perform an operation on each element in the array,
    one can use the flat attribute which is an iterator over all the
    elements of the array

``` {python}
import numpy as np
A=np.arange(24).reshape(4,6)
for i in A:
    """打印A的各行"""
    print(i) 

for i in A.flat:
    """打印A中的每个元素"""
    print(i)

"""END"""
```

# 形状操作

### 改变数组的形状

1.  数组的形状由每个轴上元素的数目决定
2.  数组的形状可以通过多种命令进行改变
3.  要注意的是以下三种命令都返回一个调整过的数组，但并不改变原始数组：

<!-- -->

1.  `ndarray.ravel(), ndarray.T, ndarry.reshape`
    1.  `ndarray.resize` 方法调整的是数组本身

``` {python}
import numpy as np
a = np.floor(10 * np.random.random((3,4)))
a.shape



a.ravel()
a.T
a.reshape(2,6)
a.resize(2,6)

"""END"""
```

### 将不同数组堆叠在一起

1.  `hstack, vstack`
2.  `column_stack, row_stack`
3.  `concatenate`
4.  `c_, r_`

### 将一个数组拆分为几个较小的数组

1.  `hsplit`
2.  `vsplit`
3.  `array_split`

# 奇妙的索引和索引技巧

### 用一维索引数组进行索引

1.  使用 `np.array` 对象作为索引下标可以取非连续元素

``` {python}
a = np.arange(12) ** 2 # the first 12 square numbers
i = np.array( [ 1,1,3,8,5 ] ) # an array of indices
a[i] # the elements of a at the positions i
np.array([ 1, 1, 9, 64, 25])

j = np.array( [ [ 3, 4], [ 9, 7 ] ] )
a[j]



"""END"""
```

### 用二维索引数组进行索引

1.  我们也可以给出多维索引。每个维度的索引数组必须具有相同的形状。
2.  当然，我们也可以将i和j放入一个序列（比如一个列表）中，然后使用列表进行索引。

``` {python}
a = np.arange(12).reshape(3,4)
i = np.array([[0,1], [1,2]])
j = np.array([[2,1], [3,3]])

a[i]
a[i,j]
a[i, 2]
a[:,j]

L = [i,j]
a[L]

"""END"""
```

### 用布尔数组进行索引

1.  使用与原始数组具有相同形状的布尔数组
2.  对数组的每个维度，我们给出一个一维布尔数组，以选择我们想要的切片
3.  要注意的是，一维布尔数组的长度须与你想要的切片的维度（或轴）的长度一致。

``` {python}
a = np.arange(12).reshape(3,4)
b=a>4
a[b]
a[b]=0

a = np.arange(12).reshape(3,4)
b1 = np.array([False,True,True])
b2 = np.array([True,False,True,False])
a[b1,:]
a[b1]
a[:,b2]
a[b1,b2]

"""END"""
```

### 用字符串进行索引

1.  结构化数组是ndarray，其数据类型是由命名字段的序列组织成的简单数据类型的组合。
2.  你可以通过字段名进行索引，来获取和修改结构化数组的单个字段。
3.  可以使用多字段索引来对结构化数组进行索引和赋值，其中的索引是字段名的一个列表。

``` {python}
x = np.array([('Rex', 9, 81.0), ('Fido', 3, 27.0)],
             dtype=[('name', 'U10'), ('age', 'i4'), ('weight', 'f4')])
x['name']
x[['name', 'age']]

"""END"""
```

### ix~()~ 函数

1.  ix\_ 函数可用于组合不同的向量，以获得每个n耦合的结果。(类似于R中的 `expand.grid` 函数)
2.  例如，如果你想要计算从向量a, b和c中提取的所有三元组的a+b\*c：

``` {python}
a = np.array([2,3,4,5])
b = np.array([8,5,4])
c = np.array([5,4,6,8,3])
ax,bx,cx = np.ix_(a,b,c)

result = ax+bx * cx
result

"""END"""
```

# 通用函数UNIVERSAL FUNCTIONS (UFUNC)

### 简介

1.  通用函数（简称为ufunc）是一种ndarrays 以逐元素方式操作的函数；
2.  也就是说，ufunc是一个函数的“矢量化”包装器，它接受固定数量的特定输入并产生固定数量的特定输出；
3.  在Numpy中，通用函数是numpy.ufunc类的实例；
4.  许多内置函数都是在编译的C代码中实现的。

### 常见通用函数

1.  数学运算
2.  三角函数
3.  浮动函数
4.  。。。

# 统计功能

### 顺序统计量

  函数                                      功能
  ----------------------------------------- ---------------------------------------------------------------------------------------------
  amin(a\[, axis, out, keepdims\])          返回数组或沿着某轴方向上元素的最小值
  amax(a\[, axis, out, keepdims\])          返回数组或沿着某轴方向上元素的最大值
  nanmin(a\[, axis, out, keepdims\])        返回数组或沿着某轴方向上元素的最小值，忽略NAN
  nanmax(a\[, axis, out, keepdims\])        返回数组或沿着某轴方向上元素的最小值，忽略NAN
  ptp(a\[, axis, out\])                     沿着某轴方向上元素的取值范围（最大值-最小值）
  percentile(a, q\[, axis, out, ...\])      计算沿指定轴的数据的第q个百分位数
  nanpercentile(a, q\[, axis, out, ...\])   计算沿指定轴的数据的第q个百分位数，同时忽略NAN值

### 平均数和方差

  函数                                                   功能
  ------------------------------------------------------ ------------------------------------------------------------------------------
  median(a\[, axis, out, overwrite~input~, keepdims\])   计算沿指定轴的中位数
  average(a\[, axis, weights, returned\])                计算沿指定轴的加权平均数
  mean(a\[, axis, dtype, out, keepdims\])                计算沿指定轴的算术平均数
  std(a\[, axis, dtype, out, ddof, keepdims\])           计算沿指定轴的标准差
  var(a\[, axis, dtype, out, ddof, keepdims\])           计算沿指定轴的方差
  nanmedian(a\[, axis, out, overwrite~input~, ...\])     计算沿指定轴的中位数，同时忽略NaN
  nanmean(a\[, axis, dtype, out, keepdims\])             计算沿指定轴的算术平均数，同时忽略NaN
  nanstd(a\[, axis, dtype, out, ddof, keepdims\])        计算沿指定轴的标准差，同时忽略NaN
  nanvar(a\[, axis, dtype, out, ddof, keepdims\])        计算沿指定轴的方差，同时忽略NaN

注：几何平均数，调和平均数函数在scipy中

### 相关性

  函数                                               功能
  -------------------------------------------------- ---------------------------------------------------------
  corrcoef(x\[, y, rowvar, bias, ddof\])             返回皮尔逊乘积矩相关系数
  correlate(a, v\[, mode\])                          两个一维序列的相关关系
  cov(m\[, y, rowvar, bias, ddof, fweights, ...\])   根据已知数据和权重，求协方差矩阵

### 直方图

# 线性代数 (numpy.linalg)

### 常见矩阵运算- 矩阵与向量积

\scriptsize

  函数                         功能
  ---------------------------- -------------------------------------------------
  dot(a, b)                    两个数组的点积
  vdot(a, b)                   两个向量的点积
  inner(a, b)                  两个数组的内积
  outer(a, b)                  两个向量的外积
  linalg.matrix~power~(M, n)   将一个方阵转化到（整数）次方（矩阵乘幂）
  kron(a, b)                   两个矩阵的Kronecker积

### 常见矩阵运算- 矩阵分解

\scriptsize

  函数                 功能
  -------------------- -------------------------------------------------------------------
  linalg.cholesky(a)   求Cholesky分解
  linalg.qr(a)         计算矩阵的qr分解
  linalg.svd(a)        奇异值分解
  linalg.eig(a)        计算方阵的特征值和特征向量
  scipy.linalg.lu(a)   计算矩阵的LU分解

### 常见矩阵运算- 范数等

\scriptsize

  函数                     功能
  ------------------------ ----------------------------------------------
  linalg.norm(x)           求矩阵或向量的范数
  linalg.cond(x)           计算矩阵的条件数
  linalg.det(a)            计算一个数组的行列式的值
  linalg.matrix~rank~(M)   使用SVD法（奇异值分解）求矩阵的秩
  trace(a)                 求矩阵的迹（对角线元素之和）

### 常见矩阵运算- 解线性方程组与逆矩阵

\scriptsize

  函数                       功能
  -------------------------- -----------------------------------------------------------------------
  linalg.solve(a, b)         求解线性矩阵方程或线性标量方程组
  linalg.tensorsolve(a, b)   求解张量方程Ax=b中的x
  linalg.lstsq(a, b)         求解线性矩阵方程的最小二乘解
  linalg.inv(a)              计算矩阵的（乘法）逆矩阵
  linalg.pinv(a)             计算矩阵的（Moore-Penrose）伪逆

# Random sampling (numpy.random)

### 简介

1. 下面这些函数主要用于随机抽样和生成随机数字，关于概率，分位点等计算见  `scipy.stats` 模块
2. 下面函数都以 `np.random.` 开始
3. 有很多功能相同名字不同的函数

### Simple random data

\scriptsize

  函数                                    功能
  --------------------------------------- -----------------------------------------------------------------------
  rand(d0, d1, ..., dn)                   Random values in a given shape.
  randn(d0, d1, ..., dn)                  Return a sample (or samples) from the "standard normal" distribution.
  randint(low\[, high, size, dtype\])     Return random integers from low (inclusive) to high (exclusive).
  random~integers~(low\[, high, size\])   Random integers of type np.int between low and high, inclusive.
  random~sample~(\[size\])                Return random floats in the half-open interval \[0.0, 1.0).
  random(\[size\])                        Return random floats in the half-open interval \[0.0, 1.0).
  ranf(\[size\])                          Return random floats in the half-open interval \[0.0, 1.0).
  sample(\[size\])                        Return random floats in the half-open interval \[0.0, 1.0).
  choice(a\[, size, replace, p\])         Generates a random sample from a given 1-D array
  bytes(length)                           Return random bytes.

### Permutations

\scriptsize

  函数             功能
  ---------------- ----------------------------------------------------------
  shuffle(x)       Modify a sequence in-place by shuffling its contents.
  permutation(x)   Randomly permute a sequence, or return a permuted range.

### Distribution

\scriptsize

  函数                                             功能
  ------------------------------------------------ -----------------------------------------------------------------------------------------------------------------------
  beta(a, b\[, size\])                             Draw samples from a Beta distribution.
  binomial(n, p\[, size\])                         Draw samples from a binomial distribution.
  chisquare(df\[, size\])                          Draw samples from a chi-square distribution.
  dirichlet(alpha\[, size\])                       Draw samples from the Dirichlet distribution.
  exponential(\[scale, size\])                     Draw samples from an exponential distribution.
  f(dfnum, dfden\[, size\])                        Draw samples from an F distribution.
  gamma(shape\[, scale, size\])                    Draw samples from a Gamma distribution.
  geometric(p\[, size\])                           Draw samples from the geometric distribution.
  gumbel(\[loc, scale, size\])                     Draw samples from a Gumbel distribution.
  hypergeometric(ngood, nbad, nsample\[, size\])   Draw samples from a Hypergeometric distribution.
  laplace(\[loc, scale, size\])                    Draw samples from the Laplace or double exponential distribution with specified location (or mean) and scale (decay).
  logistic(\[loc, scale, size\])                   Draw samples from a logistic distribution.
  lognormal(\[mean, sigma, size\])                 Draw samples from a log-normal distribution.
  logseries(p\[, size\])                           Draw samples from a logarithmic series distribution.

### Distributions

\scriptsize

  函数                                             功能
  ------------------------------------------------ -----------------------------------------------------------------------------------
  multivariate~normal~(mean, cov\[, size, ...\])   Draw random samples from a multivariate normal distribution.
  negative~binomial~(n, p\[, size\])               Draw samples from a negative binomial distribution.
  noncentral~chisquare~(df, nonc\[, size\])        Draw samples from a noncentral chi-square distribution.
  noncentral~f~(dfnum, dfden, nonc\[, size\])      Draw samples from the noncentral F distribution.
  normal(\[loc, scale, size\])                     Draw random samples from a normal (Gaussian) distribution.
  pareto(a\[, size\])                              Draw samples from a Pareto II or Lomax distribution with specified shape.
  poisson(\[lam, size\])                           Draw samples from a Poisson distribution.
  power(a\[, size\])                               Draws samples in \[0, 1\] from a power distribution with positive exponent a - 1.
  rayleigh(\[scale, size\])                        Draw samples from a Rayleigh distribution.
  standard~cauchy~(\[size\])                       Draw samples from a standard Cauchy distribution with mode = 0.
  standard~exponential~(\[size\])                  Draw samples from the standard exponential distribution.
  standard~gamma~(shape\[, size\])                 Draw samples from a standard Gamma distribution.
  standard~normal~(\[size\])                       Draw samples from a standard Normal distribution (mean=0, stdev=1).
  standard~t~(df\[, size\])                        Draw samples from a standard Student's t distribution with df degrees of freedom.
  triangular(left, mode, right\[, size\])          Draw samples from the triangular distribution over the interval \[left, right\].
  uniform(\[low, high, size\])                     Draw samples from a uniform distribution.
  vonmises(mu, kappa\[, size\])                    Draw samples from a von Mises distribution.
  wald(mean, scale\[, size\])                      Draw samples from a Wald, or inverse Gaussian, distribution.
  weibull(a\[, size\])                             Draw samples from a Weibull distribution.
  zipf(a\[, size\])                                Draw samples from a Zipf distribution.

### Random generator

\scriptsize

  函数                    功能
  ----------------------- --------------------------------------------------------------------
  RandomState(\[seed\])   Container for the Mersenne Twister pseudo-random number generator.
  seed(\[seed\])          Seed the generator.
  get~state~()            Return a tuple representing the internal state of the generator.
  set~state~(state)       Set the internal state of the generator from a tuple.

# Functions and Methods Overview

### Functions and Methods Overview

1.  **Array Creation**:

    arange, array, copy, empty, empty~like~, eye, fromfile,
    fromfunction,identity, linspace, logspace, mgrid, ogrid, ones,
    ones~like~, r, zeros, zeros~like~

2.  **Conversions**:

    ndarray.astype, atleast~1d~, atleast~2d~, atleast~3d~, mat

3.  **Manipulations**:

    array~split~, column~stack~, concatenate, diagonal, dsplit, dstack,
    hsplit,hstack, ndarray.item, newaxis, ravel, repeat, reshape,
    resize, squeeze, swapaxes, take, transpose, vsplit, vstack

### Functions and Methods Overview

1.  **Questions**:

    all, any, nonzero, where

2.  **Ordering**:

    argmax, argmin, argsort, max, min, ptp, searchsorted, sort

3.  **Operations**:

    choose, compress, cumprod, cumsum, inner, ndarray.fill, imag, prod,
    put, putmask,real, sum

4.  **Basic Statistics**:

    cov, mean, std, var

5.  **Basic Linear Algebra**:

    cross, dot, outer, linalg.svd, vdot

# Other Subpackages

### Numpy中的其他常用模块

1.  String operations
2.  Datetime Support Functions
3.  Discrete Fourier Transform (numpy.fft)
4.  Financial functions
5.  Functional programming
6.  Logic functions
7.  Mathematical functions
8.  Matrix library (numpy.matlib)
9.  numpy.polynomial package
10. 具体用法和更多模块可以参考 Numpy reference\[numpy-ref.pdf\]中的
    Routines 内容


<!-- # 参考文献 -->
[//]: # (\bibliography{Bibfile})
