---
title: "Numpy 用法"
author: "Jin"
date: "2020年6月"
institute: 中南财经政法大学统计与数学学院
csl: ./style/chinese-gb7714-2015-numeric.csl
css: ./style/markdown.css
bibliography: [./Bibfile.bib]
eqnPrefixTemplate: ($$i$$)
link-citations: true
linkReferences: true
chapters: true
tableEqns: false
autoEqnLabels: false
classoption: "aspectratio=1610"
---

```{r setup, echo=F, purl=F}
knitr::opts_knit$set(root.dir = getwd())
knitr::opts_chunk$set(echo = TRUE, results = 'hide')
knitr::opts_chunk$set(warning = FALSE, message=FALSE)
knitr::opts_chunk$set(fig.align="center"
                      ## ,out.width="0.9\\textwidth" # latex
                      ,out.width="80%" # for both latex and html
                      ,fig.width=5, fig.height=3
                      )
```

```{r prepare, echo=F, purl=F}
rm(list=ls())
options(digits=4)
options(scipen=100)
graphics.off()
Sys.setlocale("LC_ALL", "Chinese")
library(reticulate)
```


# Introduction


### Facts

1.  Initial release: As Numeric, 1995; as NumPy, 2006
2.  Stable release: 1.11.2 / 3 October 2016;
3.  Website: <http://www.numpy.org>
4.  History: <https://en.wikipedia.org/wiki/NumPy>

### What is NumPy?

1.  NumPy is the fundamental package for scientific computing in Python.
2.  It is a Python library that provides a multidimensional array
    object, various derived objects (such as masked arrays and
    matrices), and an assortment of routines for fast operations on
    arrays, including


1.  mathematical,
2.  logical,
3.  shape manipulation,
4.  sorting, selecting, I/O,
5.  discrete Fourier transforms, basic linear algebra,
6.  basic statistical operations, random simulation and much more.

### NumPy

1.  At the core of the NumPy package, is the **ndarray** object.
2.  This encapsulates n-dimensional arrays of homogeneous data types,
    with many operations being performed in compiled code for
    performance.
3.  The points about sequence size and speed are particularly important
    in scientific computing.

### ndarray object

1.  Vectorization:Vectorization describes the absence of any explicit
    looping, indexing, etc., in the code - these things are taking
    place, of course, just "behind the scenes" in optimized,
    pre-compiled C code.
2.  Broadcasting:Broadcasting is the term used to describe the implicit
    element-by-element behavior of operations.
3.  NumPy fully supports an object-oriented approach with ndarray.
    ndarray is a class, possessing numerous methods and attributes.

# Basics

## Array Creation

### `array` function

1.  create an array from a regular Python list or tuple using the
    **`array`** function. The type of the resulting array is deduced
    from the type of the elements in the sequences.
2.  array transforms sequences of sequences into two-dimensional arrays,
    sequences of sequences of sequences into three-dimensional arrays,
    and so on.
3.  Often, the elements of an array are originally unknown, but its size
    is known.

### arrays with initial placeholder content

1.  The function **`zeros`** creates an array full of zeros,
2.  the function **`ones`** creates an array full of ones,
3.  the function **`empty`** creates an array whose initial content is
    random and depends on the state of the memory.
4.  the function `diag` creates the diagonal array,
5.  the function **`eye`** or **`identity`** creates an array with ones
    on the diagonal and zeros elsewhere.

### `arange` and `linspace` function

1.  **`arange`**:
2.  **`linspace`**:

### ndarray对象的属性

1.  ndarray.ndim
2.  ndarray.shape
3.  ndarray.size
4.  ndarray.dtype
5.  ndarray.itemsize
6.  ndarray.data

## 基本操作

### 基本操作

1.  数组上的算术运算符按元素方式应用。创建一个新的数组并填充结果。
2.  矩阵乘积可使用点函数或方法执行:
3.  许多一元运算，比如计算数组中所有元素的总和，都是作为ndarray类的方法实现的。
4.  通过指定轴参数，可以应用一个沿着数组的指定轴进行的操作(类似于R中的apply函数)。

### 例子

``` {python}
import numpy as np
a=np.arange(4)
b=np.array([2,5,8,9])
a*b

A=np.arange(12).reshape(3,4)
B=np.arange(13,25).reshape(4,3)
np.dot(A, B)
A.dot(B)
A.sum()
A.sum(axis=0)
A.sum(axis=1)

"""END"""
```

### 通用函数

1.  NumPy提供了熟悉的数学函数，如sin、cos和exp。
2.  在NumPy中，这些函数称为\“通用函数\”(ufunc)。
3.  在NumPy中，这些函数按元素对数组进行操作，生成一个数组作为输出。

``` {python}
A=np.arange(12).reshape(3,4)
np.exp(A)
np.sqrt(A)

"""END"""
```

## 索引、切片和迭代

### 索引、切片和迭代

1.  一维数组可以被索引、切片和迭代，就像列表和其他Python序列一样。

``` {python}
x=np.arange(12)**2
x[3]
x[2:6]
x[7:]
x[::-1]
x[9:2:-3]

"""END"""
```

### 索引、切片和迭代

1.  多维数组每个轴可以有一个索引。这些索引以元组的形式给出，中间用逗号分隔。
2.  当提供的索引少于轴的数量时，缺失的索引被认为是完整的片。

``` {python}
A=np.arange(24).reshape(4,6)
A[2,3]
A[1:3, 2:4]
A[1]
A[:, 2:4]
A[..., 3]

"""END"""
```

### 索引、切片和迭代

1.  点(…)表示生成完整索引元组所需的冒号。
2.  例如，如果x是一个有5个轴的数组，那么

-   `x[1, 2, ...]` is equivalent to `x[1, 2, :, :, :]`,
-   `x[..., 3]` to `x[:, : ,: ,:, 3]`
-   `x[4, ..., 5, :]` to `x[4, :, :, 5, :]`

### Indexing, Slicing and Iterating

1.  Iterating over multidimensional arrays is done with respect to
    the first axis
2.  if one wants to perform an operation on each element in the array,
    one can use the flat attribute which is an iterator over all the
    elements of the array

``` {python}
import numpy as np
A=np.arange(24).reshape(4,6)
for i in A:
    """打印A的各行"""
    print(i) 

for i in A.flat:
    """打印A中的每个元素"""
    print(i)

"""END"""
```

# 形状操作

### 改变数组的形状

1.  数组的形状由每个轴上元素的数目决定
2.  数组的形状可以通过多种命令进行改变
3.  要注意的是以下三种命令都返回一个调整过的数组，但并不改变原始数组：

<!-- -->

1.  `ndarray.ravel(), ndarray.T, ndarry.reshape`
    1.  `ndarray.resize` 方法调整的是数组本身

``` {python}
import numpy as np
a = np.floor(10 * np.random.random((3,4)))
a.shape



a.ravel()
a.T
a.reshape(2,6)
a.resize(2,6)

"""END"""
```

### 将不同数组堆叠在一起

1.  `hstack, vstack`
2.  `column_stack, row_stack`
3.  `concatenate`
4.  `c_, r_`

### 将一个数组拆分为几个较小的数组

1.  `hsplit`
2.  `vsplit`
3.  `array_split`

# 奇妙的索引和索引技巧

### 用一维索引数组进行索引

1.  使用 `np.array` 对象作为索引下标可以取非连续元素

``` {python}
a = np.arange(12) ** 2 # the first 12 square numbers
i = np.array( [ 1,1,3,8,5 ] ) # an array of indices
a[i] # the elements of a at the positions i
np.array([ 1, 1, 9, 64, 25])

j = np.array( [ [ 3, 4], [ 9, 7 ] ] )
a[j]



"""END"""
```

### 用二维索引数组进行索引

1.  我们也可以给出多维索引。每个维度的索引数组必须具有相同的形状。
2.  当然，我们也可以将i和j放入一个序列（比如一个列表）中，然后使用列表进行索引。

``` {python}
a = np.arange(12).reshape(3,4)
i = np.array([[0,1], [1,2]])
j = np.array([[2,1], [3,3]])

a[i]
a[i,j]
a[i, 2]
a[:,j]

L = [i,j]
a[L]

"""END"""
```

### 用布尔数组进行索引

1.  使用与原始数组具有相同形状的布尔数组
2.  对数组的每个维度，我们给出一个一维布尔数组，以选择我们想要的切片
3.  要注意的是，一维布尔数组的长度须与你想要的切片的维度（或轴）的长度一致。

``` {python}
a = np.arange(12).reshape(3,4)
b=a>4
a[b]
a[b]=0

a = np.arange(12).reshape(3,4)
b1 = np.array([False,True,True])
b2 = np.array([True,False,True,False])
a[b1,:]
a[b1]
a[:,b2]
a[b1,b2]

"""END"""
```

### 用字符串进行索引

1.  结构化数组是ndarray，其数据类型是由命名字段的序列组织成的简单数据类型的组合。
2.  你可以通过字段名进行索引，来获取和修改结构化数组的单个字段。
3.  可以使用多字段索引来对结构化数组进行索引和赋值，其中的索引是字段名的一个列表。

``` {python}
x = np.array([('Rex', 9, 81.0), ('Fido', 3, 27.0)],
             dtype=[('name', 'U10'), ('age', 'i4'), ('weight', 'f4')])
x['name']
x[['name', 'age']]

"""END"""
```

### ix~()~ 函数

1.  ix\_ 函数可用于组合不同的向量，以获得每个n耦合的结果。(类似于R中的 `expand.grid` 函数)
2.  例如，如果你想要计算从向量a, b和c中提取的所有三元组的a+b\*c：

``` {python}
a = np.array([2,3,4,5])
b = np.array([8,5,4])
c = np.array([5,4,6,8,3])
ax,bx,cx = np.ix_(a,b,c)

result = ax+bx * cx
result

"""END"""
```

# 通用函数UNIVERSAL FUNCTIONS (UFUNC)

### 简介

1.  A universal function (or ufunc for short) is a function that
    operates on ndarrays in an element-by-element fashion.
2.  That is, a ufunc is a "vectorized" wrapper for a function that takes
    a fixed number of specific inputs and produces a fixed number of
    specific outputs.
3.  In NumPy, universal functions are instances of the numpy.ufunc
    class.
4.  Many of the built-in functions are implemented in compiled C code.

### 常见通用函数

1.  Math operations
2.  Trigonometric functions
3.  Floating functions
4.  。。。

# 统计功能

### Order statistics

  函数                                      功能
  ----------------------------------------- ---------------------------------------------------------------------------------------------
  amin(a\[, axis, out, keepdims\])          Return the minimum of an array or minimum along an axis.
  amax(a\[, axis, out, keepdims\])          Return the maximum of an array or maximum along an axis
  nanmin(a\[, axis, out, keepdims\])        Return minimum of an array or minimum along an axis, ignoring any NaNs.
  nanmax(a\[, axis, out, keepdims\])        Return the maximum of an array or maximum along an axis, ignoring any NaNs.
  ptp(a\[, axis, out\])                     Range of values (maximum - minimum) along an axis.
  percentile(a, q\[, axis, out, ...\])      Compute the qth percentile of the data along the specified axis
  nanpercentile(a, q\[, axis, out, ...\])   Compute the qth percentile of the data along the specified axis, while ignoring nan values.

### Averages and variances

  函数                                                   功能
  ------------------------------------------------------ ------------------------------------------------------------------------------
  median(a\[, axis, out, overwrite~input~, keepdims\])   Compute the median along the specified axis.
  average(a\[, axis, weights, returned\])                Compute the weighted average along the specified axis.
  mean(a\[, axis, dtype, out, keepdims\])                Compute the arithmetic mean along the specified axis.
  std(a\[, axis, dtype, out, ddof, keepdims\])           Compute the standard deviation along the specified axis.
  var(a\[, axis, dtype, out, ddof, keepdims\])           Compute the variance along the specified axis.
  nanmedian(a\[, axis, out, overwrite~input~, ...\])     Compute the median along the specified axis, while ignoring NaNs.
  nanmean(a\[, axis, dtype, out, keepdims\])             Compute the arithmetic mean along the specified axis, ignoring NaNs.
  nanstd(a\[, axis, dtype, out, ddof, keepdims\])        Compute the standard deviation along the specified axis,while ignoring NaNs.
  nanvar(a\[, axis, dtype, out, ddof, keepdims\])        Compute the variance along the specified axis, while ignoring NaNs.

注：几何平均数，调和平均数函数在scipy中

### Correlating

  函数                                               功能
  -------------------------------------------------- ---------------------------------------------------------
  corrcoef(x\[, y, rowvar, bias, ddof\])             Return Pearson product-moment correlation coefficients.
  correlate(a, v\[, mode\])                          Cross-correlation of two 1-dimensional sequences.
  cov(m\[, y, rowvar, bias, ddof, fweights, ...\])   Estimate a covariance matrix, given data and weights.

### Histograms

# Linear algebra (numpy.linalg)

### 常见矩阵运算- Matrix and vector products

\scriptsize

  函数                         功能
  ---------------------------- -------------------------------------------------
  dot(a, b)                    Dot product of two arrays.
  vdot(a, b)                   Return the dot product of two vectors.
  inner(a, b)                  Inner product of two arrays.
  outer(a, b)                  Compute the outer product of two vectors.
  linalg.matrix~power~(M, n)   Raise a square matrix to the (integer) power n.
  kron(a, b)                   Kronecker product of two arrays.

### 常见矩阵运算- Decompositions

\scriptsize

  函数                 功能
  -------------------- -------------------------------------------------------------------
  linalg.cholesky(a)   Cholesky decomposition.
  linalg.qr(a)         Compute the qr factorization of a matrix.
  linalg.svd(a)        Singular Value Decomposition.
  linalg.eig(a)        Compute the eigenvalues and right eigenvectors of a square array.
  scipy.linalg.lu(a)   Compute pivoted LU decompostion of a matrix.

### 常见矩阵运算- Norms and other numbers

\scriptsize

  函数                     功能
  ------------------------ ----------------------------------------------
  linalg.norm(x)           Matrix or vector norm.
  linalg.cond(x)           Compute the condition number of a matrix.
  linalg.det(a)            Compute the determinant of an array.
  linalg.matrix~rank~(M)   Return matrix rank of array using SVD method
  trace(a)                 Return the sum along diagonals of the array.

### 常见矩阵运算- Solving equations and inverting matrices

\scriptsize

  函数                       功能
  -------------------------- -----------------------------------------------------------------------
  linalg.solve(a, b)         Solve a linear matrix equation, or system of linear scalar equations.
  linalg.tensorsolve(a, b)   Solve the tensor equation a x = b for x.
  linalg.lstsq(a, b)         Return the least-squares solution to a linear matrix equation.
  linalg.inv(a)              Compute the (multiplicative) inverse of a matrix.
  linalg.pinv(a)             Compute the (Moore-Penrose) pseudo-inverse of a matrix.

# 随机抽样 (numpy.random)

### 简介

1. 下面这些函数主要用于随机抽样和生成随机数字，关于概率，分位点等计算见  `scipy.stats` 模块
2. 下面函数都以 `np.random.` 开始
3. 有很多功能相同名字不同的函数

### 简单随机数据

\scriptsize

  函数                                    功能
  --------------------------------------- -----------------------------------------------------------------------
  rand(d0, d1, ..., dn)                   给定模型的随机值
  randn(d0, d1, ..., dn)                  从“标准正态”分布中返回一个或多个样本。
  randint(low\[, high, size, dtype\])     从低(含)到高(不含)返回随机整数。
  random~integers~(low\[, high, size\])   类型为np.int的随机整数，介于高低之间，都包括在内。
  random~sample~(\[size\])                返回半开区间内的随机浮点数。[0.0, 1.0)
  random(\[size\])                        返回半开区间内的随机浮点数[0.0, 1.0)
  ranf(\[size\])                          返回半开区间内的随机浮点数[0.0, 1.0)
  sample(\[size\])                        返回半开区间内的随机浮点数[0.0, 1.0)
  choice(a\[, size, replace, p\])         从给定的一维数组中生成一个随机样本。
  bytes(length)                           返回随机字节。

### 排列

\scriptsize

  函数             功能
  ---------------- ----------------------------------------------------------
  shuffle(x)       通过变换序列的内容就地修改序列。
  permutation(x)   随机排列一个序列，或返回一个经过排列的范围。

### Distribution 分布

\scriptsize

  函数                                             功能
  ------------------------------------------------ -----------------------------------------------------------------------------------------------------------------------
  beta(a, b\[, size\])                             从β分布中抽取样本
  binomial(n, p\[, size\])                         从二项分布中抽取样本
  chisquare(df\[, size\])                          从卡方分布中抽取样本
  dirichlet(alpha\[, size\])                       从狄利克雷分布中抽取样本
  exponential(\[scale, size\])                     从指数分布中抽取样本
  f(dfnum, dfden\[, size\])                        从F分布中抽取样本
  gamma(shape\[, scale, size\])                    从γ分布中抽取样本
  geometric(p\[, size\])                           从几何分布中抽取样本
  gumbel(\[loc, scale, size\])                     从耿贝尔分布中抽取样本
  hypergeometric(ngood, nbad, nsample\[, size\])   从超几何分布中抽取样本
  laplace(\[loc, scale, size\])                    从具有指定位置(或平均值)和比例(衰减)的拉普拉斯或双指数分布中抽取样本。
  logistic(\[loc, scale, size\])                   从logistic分布中抽取样本
  lognormal(\[mean, sigma, size\])                 从对数正态分布中抽取样本
  logseries(p\[, size\])                           从对数级数分布中抽取样本

### 分布

\scriptsize

  函数                                             功能
  ------------------------------------------------ -----------------------------------------------------------------------------------
  multivariate~normal~(mean, cov\[, size, ...\])   从多元正态分布中抽取随机样本
  negative~binomial~(n, p\[, size\])               从负二项分布中抽取样本
  noncentral~chisquare~(df, nonc\[, size\])        从非中心卡方分布中抽取样本
  noncentral~f~(dfnum, dfden, nonc\[, size\])      从非中心F分布中抽取样本
  normal(\[loc, scale, size\])                     从正态(高斯)分布中抽取随机样本
  pareto(a\[, size\])                              从指定形状的Pareto II或Lomax分布中抽取样本
  poisson(\[lam, size\])                           从泊松分布中抽取样本
  power(a\[, size\])                               从指数为正a-1的幂分布中抽取[0,1]内的样本
  rayleigh(\[scale, size\])                        从瑞利分布中抽取样本
  standard~cauchy~(\[size\])                       从模式为0的标准柯西分布中抽取样本
  standard~exponential~(\[size\])                  从标准指数分布中抽取样本
  standard~gamma~(shape\[, size\])                 从标准γ分布中抽取样本
  standard~normal~(\[size\])                       从标准正态分布中抽取样本（均值为0，标准差为1）
  standard~t~(df\[, size\])                        从自由度为df的标准学生t分布中抽取样本
  triangular(left, mode, right\[, size\])          从区间[左，右]的三角形分布中抽取样本
  uniform(\[low, high, size\])                     从均匀分布中抽取样本
  vonmises(mu, kappa\[, size\])                    从冯·米塞斯分布中抽取样本
  wald(mean, scale\[, size\])                      从Wald或逆高斯分布中抽取样本
  weibull(a\[, size\])                             从威布尔分布中抽取样本
  zipf(a\[, size\])                                从Zipf分布中抽取样本

### 随机数发生器

\scriptsize

  函数                    功能
  ----------------------- --------------------------------------------------------------------
  RandomState(\[seed\])   Mersenne Twister伪随机数生成器的容器。
  seed(\[seed\])          种子生成器
  get~state~()            返回表示生成器内部状态的元组。
  set~state~(state)       从元组设置生成器的内部状态。

# 函数和方法概述

### 函数和方法概述

1.  **创建数组**:

    arange, array, copy, empty, empty~like~, eye, fromfile,
    fromfunction,identity, linspace, logspace, mgrid, ogrid, ones,
    ones~like~, r, zeros, zeros~like~

2.  **转换**:

    ndarray.astype, atleast~1d~, atleast~2d~, atleast~3d~, mat

3.  **操作**:

    array~split~, column~stack~, concatenate, diagonal, dsplit, dstack,
    hsplit,hstack, ndarray.item, newaxis, ravel, repeat, reshape,
    resize, squeeze, swapaxes, take, transpose, vsplit, vstack

### 函数和方法概述

1.  **问题**:

    all, any, nonzero, where

2.  **排序**:

    argmax, argmin, argsort, max, min, ptp, searchsorted, sort

3.  **运作**:

    choose, compress, cumprod, cumsum, inner, ndarray.fill, imag, prod,
    put, putmask,real, sum

4.  **基本统计量**:

    cov, mean, std, var

5.  **基本线性代数**:

    cross, dot, outer, linalg.svd, vdot

# Other Subpackages 其他子包

### Numpy中的其他常用模块

1.  String operations
2.  Datetime Support Functions
3.  Discrete Fourier Transform (numpy.fft)
4.  Financial functions
5.  Functional programming
6.  Logic functions
7.  Mathematical functions
8.  Matrix library (numpy.matlib)
9.  numpy.polynomial package
10. 具体用法和更多模块可以参考 Numpy reference\[numpy-ref.pdf\]中的
    Routines 内容


<!-- # 参考文献 -->
[//]: # (\bibliography{Bibfile})
